module.exports=function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e,t){e.exports=require("vscode")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0),r=i(2);function s(e,t,i=8,r=!0){let s=t.start.with({character:Math.max(0,t.start.character-i)}),o=e.getWordRangeAtPosition(s),a=e.getText(new n.Range(o?o.start:s,t.start)),c=e.getText(t),l=t.end.translate(0,331),m=e.getText(new n.Range(t.end,l));return r&&(a=a.replace(/^\s*/g,""),m=m.replace(/\s*$/g,"")),{before:a,inside:c,after:m}}t.getPreviewChunks=s;class o{constructor(e,t,i){this.uri=e,this.results=t,this.parent=i}async getDocument(e){if(this._document||(this._document=n.workspace.openTextDocument(this.uri)),e){const e=await this.parent.move(this,!0);e&&!e.parent._document&&this._document.then(()=>e.parent.getDocument(!1))}return this._document}}t.FileItem=o;class a{constructor(e,t){this.location=e,this.parent=t}}t.ReferenceItem=a;class c{constructor(e,t,i,r){this.source=e,this.uri=t,this.position=i,this._onDidChange=new n.EventEmitter,this.onDidChange=this._onDidChange.event,this.items=r.then(e=>{const t=[];let i;e.sort(c._compareLocations);for(const n of e)i&&i.uri.toString()===n.uri.toString()||(i=new o(n.uri,[],this),t.push(i)),i.results.push(new a(n,i));return t})}static create(e,t,i){const r=Promise.resolve(n.commands.executeCommand(i,e,t)).then(e=>e?e.sort(c._compareLocations):[]);return new c(i,e,t,r)}async asHistoryItem(e){let t;try{t=await n.workspace.openTextDocument(this.uri)}catch(e){return}const i=t.getWordRangeAtPosition(this.position);if(!i)return;let{before:o,inside:a,after:c}=s(t,i),l=(o=o.replace(/s$/g,String.fromCharCode(160)))+a+(c=c.replace(/^s/g,String.fromCharCode(160))),m="vscode.executeImplementationProvider"===this.source?"implementations":"references";return new r.HistoryItem(r.HistoryItem.makeId(this.source,this.uri,this.position),a,`${n.workspace.asRelativePath(this.uri)} • ${l} • ${m}`,{arguments:e,title:"",command:"references-view.refindReference"},this.uri,this.position)}async total(){let e=0;for(const t of await this.items)e+=t.results.length;return e}async get(e){for(const t of await this.items)if(t.uri.toString()===e.toString())return t}async first(){const e=await this.items;if(0===e.length)return;for(const t of e)if(t.uri.toString()===this.uri.toString()){for(const e of t.results)if(e.location.range.contains(this.position))return e;let e;for(const i of t.results){if(i.location.range.end.isAfter(this.position))return i;e=i}if(e)return e;break}let t=0,i=c._prefixLen(e[t].toString(),this.uri.toString());for(let n=1;n<e.length;n++){c._prefixLen(e[n].uri.toString(),this.uri.toString())>i&&(t=n)}return e[t].results[0]}async remove(e){e instanceof o?(c._del(await this.items,e),this._onDidChange.fire(this)):e instanceof a&&(c._del(e.parent.results,e),0===e.parent.results.length?(c._del(await this.items,e.parent),this._onDidChange.fire(this)):this._onDidChange.fire(e.parent))}async move(e,t){const i=await this.items,n=t?1:-1,r=e=>{const t=(i.indexOf(e)+n+i.length)%i.length;return i[t]};if(e instanceof o)return t?r(e).results[0]:c._tail(r(e).results);if(e instanceof a){const t=e.parent.results.indexOf(e)+n;return t<0?c._tail(r(e.parent).results):t>=e.parent.results.length?r(e.parent).results[0]:e.parent.results[t]}}static _compareLocations(e,t){return e.uri.toString()<t.uri.toString()?-1:e.uri.toString()>t.uri.toString()?1:e.range.start.isBefore(t.range.start)?-1:e.range.start.isAfter(t.range.start)?1:0}static _prefixLen(e,t){let i=0;for(;i<e.length&&i<t.length&&e.charCodeAt(i)===t.charCodeAt(i);)i+=1;return i}static _del(e,t){const i=e.indexOf(t);i>=0&&e.splice(i,1)}static _tail(e){return e[e.length-1]}}t.ReferencesModel=c;class l{constructor(e,t=0){this._mem=e,this._value=t;const i=e.get(l._key);this.value="number"==typeof i&&i>=0&&i<=1?i:t}get value(){return this._value}set value(e){this._value=e,n.commands.executeCommand("setContext","references-view.callHierarchyMode",0===this._value?"showIncoming":"showOutgoing"),this._mem.update(l._key,e)}}t.RichCallsDirection=l,l._key="references-view.callHierarchyMode";class m{constructor(e,t,i){this.item=e,this.parent=t,this.locations=i}}t.CallItem=m;class d{constructor(e,t,i){this.uri=e,this.position=t,this.direction=i,this.source="callHierarchy",this.roots=Promise.resolve(n.commands.executeCommand("vscode.prepareCallHierarchy",e,t)).then(e=>e?e.map(e=>new m(e,void 0,void 0)):[])}async resolveCalls(e){if(0===this.direction){const t=await n.commands.executeCommand("vscode.provideIncomingCalls",e.item);return t?t.map(t=>new m(t.from,e,t.fromRanges.map(e=>new n.Location(t.from.uri,e)))):[]}{const t=await n.commands.executeCommand("vscode.provideOutgoingCalls",e.item);return t?t.map(t=>new m(t.to,e,t.fromRanges.map(t=>new n.Location(e.item.uri,t)))):[]}}changeDirection(){return new d(this.uri,this.position,0===this.direction?1:0)}async isEmpty(){return 0===(await this.roots).length}async first(){const[e]=await this.roots;return e}async asHistoryItem(e){const[t]=await this.roots,i=0===this.direction?"calls from":"callers of";return new r.HistoryItem(r.HistoryItem.makeId(t.item.uri,t.item.selectionRange.start.line,t.item.selectionRange.start.character,this.direction),t.item.name,`${n.workspace.asRelativePath(this.uri)}  • ${i}`,{arguments:e,title:"",command:"references-view.showCallHierarchy"},this.uri,this.position)}}t.CallsModel=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0);t.HistoryItem=class{constructor(e,t,i,n,r,s){this.id=e,this.label=t,this.description=i,this.command=n,this.uri=r,this.position=s}static makeId(...e){let t="";for(const i of e)t+=String(i);return Buffer.from(t).toString("base64")}};t.History=class{constructor(){this._items=new Map}get isEmpty(){return 0==this._items.size}*[Symbol.iterator](){let e=[...this._items.values()];for(let t=e.length-1;t>=0;t--)yield e[t]}add(e){e&&(this._items.delete(e.id),this._items.set(e.id,e),n.commands.executeCommand("setContext","reference-list.hasHistory",!0))}get(e){return this._items.get(e)}clear(){this._items.clear(),n.commands.executeCommand("setContext","reference-list.hasHistory",!1)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0),r=i(4),s=i(2),o=i(1),a=i(5);t.activate=function(e){const t=new o.RichCallsDirection(e.globalState),i=new s.History,c=new a.TreeDataProviderWrapper,l="references-view.tree",m=n.window.createTreeView(l,{treeDataProvider:c,showCollapseAll:!0}),d=new r.EditorHighlights(m);let u;n.window.onDidChangeActiveTextEditor(()=>m.visible&&d.show(),void 0,e.subscriptions),m.onDidChangeVisibility(e=>e.visible?d.show():d.hide(),void 0,e.subscriptions);const h=async e=>{var t;u=e,m.message=void 0,d.setModel(u),n.commands.executeCommand("setContext","reference-list.hasResult",Boolean(u)),n.commands.executeCommand("setContext","reference-list.source",null===(t=u)||void 0===t?void 0:t.source),(async()=>{await n.commands.executeCommand("setContext","reference-list.isActive",!0),await n.commands.executeCommand(`${l}.focus`)})(),c.update(e||i),e?g():f()},f=()=>{let e;e=i.isEmpty?"No results.":"No results. Try running a previous search again:",m.message=e,m.title="Results"},g=async()=>{if(u instanceof o.ReferencesModel){const e=await u.total(),t=await(await u.items).length;m.message=1===e&&1===t?`${e} result in ${t} file`:1===e?`${e} result in ${t} files`:1===t?`${e} results in ${t} file`:`${e} results in ${t} files`,"vscode.executeReferenceProvider"===u.source?m.title=`Results (${e})`:"vscode.executeImplementationProvider"===u.source&&(m.title=`Implementations (${e})`)}else u instanceof o.CallsModel?(0===u.direction?m.title="Callers Of":m.title="Calls From",m.message=""):(m.message=void 0,m.title="Results")},p=async e=>{if(h(e),e){if(0===(await e.items).length)return void h(void 0);const t=await e.first();t&&m.visible&&m.reveal(t,{select:!0,focus:!0}),i.add(await e.asHistoryItem([e.source,e.uri,e.position]))}},v=async(e,t,i)=>{let r;if(t instanceof n.Uri&&i instanceof n.Position)r=o.ReferencesModel.create(t,i,e);else if(n.window.activeTextEditor){let t=n.window.activeTextEditor;t.document.getWordRangeAtPosition(t.selection.active)&&(r=o.ReferencesModel.create(t.document.uri,t.selection.active,e))}p(r)},w=e=>{e instanceof s.HistoryItem&&n.commands.executeCommand(e.command.command,...e.command.arguments)},y=async(e,r,s=t.value)=>{let a;if(e instanceof n.Uri&&r instanceof n.Position)a=new o.CallsModel(e,r,s);else if(n.window.activeTextEditor){let e=n.window.activeTextEditor;e.document.getWordRangeAtPosition(e.selection.active)&&(a=new o.CallsModel(e.document.uri,e.selection.active,s))}if(h(a),a instanceof o.CallsModel){if(await a.isEmpty())return void h(void 0);const e=await a.first();e&&m.visible&&m.reveal(e,{select:!0,focus:!0,expand:!0}),i.add(await a.asHistoryItem([a.uri,a.position,a.direction]))}},C=async(e,i)=>(t.value=e,i instanceof o.CallItem?y(i.item.uri,i.item.selectionRange.start,e):u instanceof o.CallsModel?y(u.uri,u.position,e):void 0),b=(e,t)=>{let i,r,a=!t;if(e instanceof o.ReferenceItem){const{location:t}=e;i=t.uri,r=t.range.start}else e instanceof o.CallItem?(i=e.item.uri,r=e.item.selectionRange.start):e instanceof s.HistoryItem&&(i=e.uri,r=e.position,a=!1);i&&r&&n.window.showTextDocument(i,{selection:new n.Range(r,r),preserveFocus:a})},_=e=>{if(!(u instanceof o.ReferencesModel))return;const t=m.selection[0]||u.first();if(t instanceof s.HistoryItem||t instanceof o.CallItem)return;const i=u.move(t,e);i&&(m.reveal(i,{select:!0}),b(i,!0))},S=async e=>{let t="",i=[e];for(;i.length>0;){let e=i.pop();if(e instanceof o.ReferencesModel)i.push(...(await e.items).slice(0,99));else if(e instanceof o.ReferenceItem){let i=await e.parent.getDocument(),n=o.getPreviewChunks(i,e.location.range,21,!1);t+=`  ${e.location.range.start.line+1}, ${e.location.range.start.character+1}: ${n.before+n.inside+n.after} \n`}else e instanceof o.FileItem&&(t+=`${n.workspace.asRelativePath(e.uri)} \n`,i.push(...e.results))}t&&await n.env.clipboard.writeText(t)},x=async(e,t,i)=>{await p(new o.ReferencesModel("vscode.executeReferenceProvider",e,t,Promise.resolve(i)))};let I;const T="references.preferredLocation";function D(e){if(e&&!e.affectsConfiguration(T))return;const t=n.workspace.getConfiguration().get(T);I&&(I.dispose(),I=void 0),"view"===t&&(I=n.commands.registerCommand("editor.action.showReferences",x))}D(),e.subscriptions.push(m,n.workspace.onDidChangeConfiguration(D),n.commands.registerCommand("references-view.find",()=>v("vscode.executeReferenceProvider")),n.commands.registerCommand("references-view.findImplementations",()=>v("vscode.executeImplementationProvider")),n.commands.registerCommand("references-view.refindReference",v),n.commands.registerCommand("references-view.showCallHierarchy",y),n.commands.registerCommand("references-view.showOutgoingCalls",e=>C(1,e)),n.commands.registerCommand("references-view.showIncomingCalls",e=>C(0,e)),n.commands.registerCommand("references-view.refind",w),n.commands.registerCommand("references-view.refresh",async()=>{const[e]=i;e&&w(e)}),n.commands.registerCommand("references-view.clear",async()=>{h(void 0)}),n.commands.registerCommand("references-view.clearHistory",async()=>{i.clear(),h(void 0)}),n.commands.registerCommand("references-view.show",b),n.commands.registerCommand("references-view.remove",e=>{if(u instanceof o.ReferencesModel){const t=u.move(e,!0);u.remove(e),d.refresh(),g(),t&&m.reveal(t,{select:!0})}}),n.commands.registerCommand("references-view.next",()=>_(!0)),n.commands.registerCommand("references-view.prev",()=>_(!1)),n.commands.registerCommand("references-view.copy",S),n.commands.registerCommand("references-view.copyAll",()=>S(u)),n.commands.registerCommand("references-view.copyPath",e=>{e instanceof o.FileItem&&("file"===e.uri.scheme?n.env.clipboard.writeText(e.uri.fsPath):n.env.clipboard.writeText(e.uri.toString(!0)))}),n.commands.registerCommand("references-view.pickFromHistory",async()=>{const e=[...i].map(e=>({label:e.label,description:e.description,item:e})),t=await n.window.showQuickPick(e,{placeHolder:"Select previous reference search"});t&&await w(t.item)}))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0),r=i(1);t.EditorHighlights=class{constructor(e){this._view=e,this._decorationType=n.window.createTextEditorDecorationType({backgroundColor:new n.ThemeColor("editor.findMatchHighlightBackground"),rangeBehavior:n.DecorationRangeBehavior.ClosedClosed,overviewRulerLane:n.OverviewRulerLane.Center,overviewRulerColor:new n.ThemeColor("editor.findMatchHighlightBackground")}),this._ignore=new Set}setModel(e){this._model=e,this._ignore.clear(),this._listener&&this._listener.dispose(),e instanceof r.ReferencesModel?this._listener=n.workspace.onDidChangeTextDocument(async t=>{this._ignore.add(await e.get(t.document.uri))}):e instanceof r.CallsModel&&(this._listener=this._view.onDidChangeSelection(()=>{this.show()})),this.show()}async show(){const{activeTextEditor:e}=n.window;if(e){const t=[];if(this._model instanceof r.ReferencesModel){const i=await this._model.get(e.document.uri);i&&!this._ignore.has(i)&&t.push(...i.results.map(e=>e.location.range))}else if(this._model instanceof r.CallsModel){const[i]=this._view.selection;if(i instanceof r.CallItem){let r=i.locations;r||(r=[new n.Location(i.item.uri,i.item.selectionRange)]);for(const i of r)i.uri.toString()===e.document.uri.toString()&&t.push(i.range)}}e.setDecorations(this._decorationType,t)}}hide(){const{activeTextEditor:e}=n.window;e&&e.setDecorations(this._decorationType,[])}refresh(){this.hide(),this.show()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0),r=i(1);class s{constructor(e){this._model=e,this._onDidChangeTreeData=new n.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event,this._modelListener=e.onDidChange(e=>this._onDidChangeTreeData.fire(e instanceof r.FileItem?e:void 0))}dispose(){this._onDidChangeTreeData.dispose(),this._modelListener.dispose()}async getTreeItem(e){if(e instanceof r.FileItem){const t=new n.TreeItem(e.uri);return t.contextValue="file-item",t.description=!0,t.iconPath=n.ThemeIcon.File,t.collapsibleState=n.TreeItemCollapsibleState.Collapsed,t}{const{range:t}=e.location,i=await e.parent.getDocument(!0),{before:s,inside:o,after:a}=r.getPreviewChunks(i,t),c={label:s+o+a,highlights:[[s.length,s.length+o.length]]},l=new n.TreeItem2(c);return l.collapsibleState=n.TreeItemCollapsibleState.None,l.contextValue="reference-item",l.command={command:"references-view.show",title:"Open Reference",arguments:[e]},l}}async getChildren(e){return e?e instanceof r.FileItem?e.results:void 0:this._model.items}getParent(e){return e instanceof r.ReferenceItem?e.parent:void 0}}t.ReferencesProvider=s;class o{constructor(e){this._model=e,this._emitter=new n.EventEmitter,this.onDidChangeTreeData=this._emitter.event}getTreeItem(e){const t=new n.TreeItem(e.item.name);return t.description=e.item.detail,t.contextValue="call-item",t.iconPath=o._getThemeIcon(e.item.kind),t.command={command:"references-view.show",title:"Open Call",arguments:[e]},t.collapsibleState=n.TreeItemCollapsibleState.Collapsed,t}getChildren(e){return e?this._model.resolveCalls(e):this._model.roots}getParent(e){return e.parent}static _getThemeIcon(e){let t=o._themeIconIds[e];return t&&new n.ThemeIcon(t)}}t.CallItemDataProvider=o,o._themeIconIds={[n.SymbolKind.File]:"symbol-file",[n.SymbolKind.Module]:"symbol-module",[n.SymbolKind.Namespace]:"symbol-namespace",[n.SymbolKind.Package]:"symbol-package",[n.SymbolKind.Class]:"symbol-class",[n.SymbolKind.Method]:"symbol-method",[n.SymbolKind.Property]:"symbol-property",[n.SymbolKind.Field]:"symbol-field",[n.SymbolKind.Constructor]:"symbol-constructor",[n.SymbolKind.Enum]:"symbol-enum",[n.SymbolKind.Interface]:"symbol-interface",[n.SymbolKind.Function]:"symbol-function",[n.SymbolKind.Variable]:"symbol-variable",[n.SymbolKind.Constant]:"symbol-constant",[n.SymbolKind.String]:"symbol-string",[n.SymbolKind.Number]:"symbol-number",[n.SymbolKind.Boolean]:"symbol-boolean",[n.SymbolKind.Array]:"symbol-array",[n.SymbolKind.Object]:"symbol-object",[n.SymbolKind.Key]:"symbol-key",[n.SymbolKind.Null]:"symbol-null",[n.SymbolKind.EnumMember]:"symbol-enum-member",[n.SymbolKind.Struct]:"symbol-struct",[n.SymbolKind.Event]:"symbol-event",[n.SymbolKind.Operator]:"symbol-operator",[n.SymbolKind.TypeParameter]:"symbol-type-parameter"};class a{constructor(e){this._history=e,this._emitter=new n.EventEmitter,this.onDidChangeTreeData=this._emitter.event}getTreeItem(e){const t=new n.TreeItem(e.label);return t.description=e.description,t.command={command:"references-view.show",arguments:[e],title:"Show"},t.collapsibleState=n.TreeItemCollapsibleState.None,t.contextValue="history-item",t}getChildren(){return[...this._history]}getParent(){}}t.HistoryDataProvider=a;t.TreeDataProviderWrapper=class{constructor(){this._onDidChange=new n.EventEmitter,this.onDidChangeTreeData=this._onDidChange.event}update(e){this._providerListener&&(this._providerListener.dispose(),this._providerListener=void 0),this._provider&&"function"==typeof this._provider.dispose&&(this._provider.dispose(),this._provider=void 0),e instanceof r.ReferencesModel?this._provider=new s(e):e instanceof r.CallsModel?this._provider=new o(e):this._provider=new a(e),this._onDidChange.fire(),this._providerListener=this._provider.onDidChangeTreeData(e=>this._onDidChange.fire(e))}getTreeItem(e){return this._provider.getTreeItem(e)}getChildren(e){var t;return null===(t=this._provider)||void 0===t?void 0:t.getChildren(e)}getParent(e){var t;return null===(t=this._provider)||void 0===t?void 0:t.getParent(e)}}}]);
//# sourceMappingURL=extension.js.map